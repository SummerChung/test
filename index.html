<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合約自動化生成</title>
    
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>

    <!-- 引入外部銀行資料檔 -->
    <script src="banks.js"></script>

    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        h3 { color: #0056b3; margin-top: 25px; margin-bottom: 10px; }
        
        .page { display: none; }
        .page.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        
        /* 輸入框與選單樣式 */
        input[type="text"], input[type="number"], select, textarea { 
            width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; 
        }
        
        input[type="radio"], input[type="checkbox"] {
            width: auto; margin-right: 8px; transform: scale(1.2); cursor: pointer;
        }

        select.inline-select { width: auto; padding: 4px; margin: 0 5px; }
        .row { display: flex; gap: 10px; } .col { flex: 1; }
        .btn-group { margin-top: 20px; text-align: right; }
        
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button.secondary { background-color: #6c757d; } button.success { background-color: #28a745; }
        
        /* 表格樣式 */
        .table-input { width: 100%; border-collapse: collapse; margin-bottom: 15px; table-layout: fixed; }
        .table-input th, .table-input td { border: 1px solid #ddd; padding: 8px; text-align: center; vertical-align: middle; }
        .table-input th { background-color: #f8f9fa; font-weight: bold; color: #333; }
        .table-input input { text-align: center; }

        .checkbox-group-row { display: flex; align-items: center; gap: 25px; }
        .checkbox-group-col { display: flex; flex-direction: column; gap: 12px; }
        .checkbox-group-row label, .checkbox-group-col label { display: flex; align-items: center; font-weight: normal; cursor: pointer; margin: 0; }

        .hidden { display: none; }
        .indent { margin-left: 28px; margin-top: 5px; border-left: 2px solid #eee; padding-left: 10px; } 
        .required-mark { color: red; margin-left: 3px; }

        /* 新增：銀行代碼與選單的並排樣式 */
        .code-select-group { display: flex; gap: 5px; }
        .code-input { flex: 1; min-width: 60px; } /* 代碼輸入框較窄 */
        .name-select { flex: 3; } /* 名稱選單較寬 */
    </style>
</head>
<body>

<div class="container">
    <h1>合約自動化生成</h1>
    
    <!-- 第一頁 -->
    <div id="page1" class="page active">
        <h2>步驟 1/2：基本資料與費用</h2>
        
        <h3>1. 合約類型</h3>
        <div class="form-group">
            <div class="checkbox-group-row">
                <label><input type="radio" name="contractType" value="new"> 新簽約</label>
                <label><input type="radio" name="contractType" value="renew" checked> 續約</label>
            </div>
        </div>

        <h3>2. 合約期間 <span class="required-mark">*</span></h3>
        <div class="row">
            <div class="col">
                <label>起始日期</label>
                <div class="row">
                    <select id="startYear" onchange="calcDuration()"><option value="">年</option></select>
                    <select id="startMonth" onchange="calcDuration()"><option value="">月</option></select>
                    <select id="startDay" onchange="calcDuration()"><option value="">日</option></select>
                </div>
            </div>
            <div class="col">
                <label>結束日期</label>
                <div class="row">
                    <select id="endYear" onchange="calcDuration()"><option value="">年</option></select>
                    <select id="endMonth" onchange="calcDuration()"><option value="">月</option></select>
                    <select id="endDay" onchange="calcDuration()"><option value="">日</option></select>
                </div>
            </div>
        </div>
        <div class="form-group"><label>期間計算結果</label><input type="text" id="durationResult" readonly style="background:#e9ecef;"></div>
        <div class="form-group">
            <label>封底日期 <span style="color:blue;font-weight:bold;">(預設今日)</span></label>
            <div class="row" style="max-width:400px;"><select id="coverYear"></select><select id="coverMonth"></select><select id="coverDay"></select></div>
        </div>

        <h3>3. 基本資料</h3>
        <div class="row"><div class="col"><label>社區名稱 <span class="required-mark">*</span></label><input type="text" id="commName" required></div><div class="col"><label>地址 <span class="required-mark">*</span></label><input type="text" id="commAddr" required></div></div>
        <div class="row"><div class="col"><label>乙方 <span class="required-mark">*</span></label><input type="text" id="partyB" required></div><div class="col"><label>代表人 <span class="required-mark">*</span></label><input type="text" id="repName" required></div></div>
        <div class="row"><div class="col"><label>電話 <span class="required-mark">*</span></label><input type="text" id="phone" required></div><div class="col"><label>統一編號</label><input type="text" id="taxId"></div></div>

        <h3>4. 設備與費用 <span class="required-mark">*</span></h3>
        <table class="table-input">
            <thead>
                <tr>
                    <th width="20%">項目</th>
                    <th width="15%">數量</th>
                    <th width="25%">位置</th>
                    <th width="15%">單價</th>
                    <th width="25%">小計</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>社區EIP聯網機</td>
                    <td><input type="number" id="qty_eip_net_1" on